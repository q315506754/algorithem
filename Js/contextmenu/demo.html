<!DOCTYPE html>
<html>
<head>
<meta content="webkit" name="renderer" />
<meta charset="UTF-8">
<title>鼠标右键示例</title>
<link href="../common/assets/css/contextmenu/os_base.css" rel="stylesheet" />
<link href="../common/assets/css/contextmenu/database_m.css" rel="stylesheet" />
<link rel="stylesheet" type="text/css" href="../common/assets/css/contextmenu/context.standalone_m.css">
</head>

<body>
<div class="database-wrap">
	<!-------database-div start-------->
	<div class="databasecontet-div">
    	<div class="databasecontet-l fl">
        	<ul> 
            	<li   class="cur"><a href="javascript:void(0);" class="clearfix"><em class="allfilesico fl"></em><span class="fl">All files</span></a></li>
                <li><a href="javascript:void(0);" class="clearfix"><em class="pictureico fl"></em><span class="fl">picture</span></a></li>
                <li><a href="javascript:void(0);" class="clearfix"><em class="videoico fl"></em><span class="fl">video</span></a></li>
                <li><a href="javascript:void(0);" class="clearfix"><em class="fliesico fl"></em><span class="fl">flies</span></a></li>
            </ul>
        </div>
        <div class="databasecontet-r fl">
        	<div class="addgreatefolder-div clearfix">
            	<div class="addico fl"></div>
                <div class="greatefolder-div fr"><span class="greatefolderico"></span><p>Greatefolder</p></div>
            </div>
        	<div class="databasenav-div clearfix">
            	<span class="databasenav-l fl">My Art</span>
                <div class="databasenav-r fr">
                	<span>
                    	<span class="listico"></span>
                     </span>
                     <span class="cur">
                     	<span class="developico"></span>
                     </span>
                  </div>
             </div>
            <div class="databaselist-div nano">
                <ul class="clearfix content">
                    <li>
                        <div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file common"></span>
                               <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">painters</p></div>
                        </div>
						<input name="" type="text" class="editdataname-input"/>
                     </li>
					  
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file common"></span>
                              <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">painters and south Africal</p></div>
                        </div>
                     </li>
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                             <span class="pic"> <img   style="margin-top:23px;" src="http://image.zhihuishu.com/testzhs/able-commons/demo/201612/5bbda0a419e748f483d72f456d482782.jpg"></span>
                                <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Tomatoes</p></div>
                        </div>
                     </li>
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                                 <span class="pic"><img   style="margin-top:23px;" src="http://image.zhihuishu.com/testzhs/able-commons/demo/201612/5bbda0a419e748f483d72f456d482782.jpg"></span>
                                  <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Tomatoes</p></div>
                        </div>
                     </li>
                      <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file-word"></span>
                               <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Theme</p></div>
                        </div>
                     </li>
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file-excel"></span>
                              <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Excl</p></div>
                        </div>
                     </li>
                    
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file-pdf"></span>
                               <span class="deleteico"></span>
                           </div>
                          <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">painters</p></div>
                        </div>
                     </li>
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file-ppt"></span>
                              <span class="deleteico"></span>
                           </div>
                          <div class="editdatanameinput_div"><div class="editdataname-div"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p" style="display:none;">color</p></div>
                        </div>
                     </li>
                    
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                             <span class="pic"> <img   style="margin-top:23px; border:0;" src="http://image.zhihuishu.com/testzhs/able-commons/demo/201612/5bbda0a419e748f483d72f456d482782.jpg"></span>
                              <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Tomatoes</p></div>
                        </div>
                     </li>
                      <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="file-zip"></span>
                              <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Teach flies</p></div>
                        </div>
                     </li>
                     
                     <li>
                      	<div title="" class="databasecontetdiv cur">
                          <div class="icotop-span">
                              <span class="video"><img src="http://image.zhihuishu.com/testzhs/able-commons/demo/201612/13f4768b38f7474a840cca625a85f892.png"></span>
                                <span class="deleteico"></span>
                           </div>
                           <div class="editdatanameinput_div"><div class="editdataname-div" style="display:none;"><input name="" type="text" class="editdataname-input"/></div><p class="editdataname-p">Teach flies</p></div>
                        </div>
                     </li>
                     
                </ul>
            </div>
        </div>
    </div>
    <!-------database-div end -------->
</div>
<script src="../common/assets/js/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
<!--<script src="scripts/scrollbar.js" type="text/javascript"></script>-->
<script src="../common/assets/js/contextmenu/context.js"></script>
<script>

    var contextMenuConfig = {
        "getKeyByText":function (str) {
            for(var k in contextMenuConfig){
                var dataOne = contextMenuConfig[k];
                if(typeof dataOne === 'object'){
                    if(dataOne.text==str){
                        return k;
                    }
                }
            }
        },
        "privilage":{
            text: 'Teacher visible',
            href: '#',
            action:function (e) {
                e.preventDefault();
                console.log(e);

            }
        },
        "rename":{
            text: 'Rename',
            href: '#',
            action:function (e) {
                e.preventDefault();
                e.stopPropagation();

                context.closeAll();

                // changeToInputStatus(findP);
            }
        },
        "download":{
            text: 'Download',
            href: '#'
        },
        "cut":{
            text: 'Cut',
            href: '#',
            action:function (e) {
                e.preventDefault();
                console.log('action cut');


            }
        },
        "copy":{
            text: 'Copy',
            href: '#'
        },
        "createFolder":{
            text: 'Create Folder',
            href: '#'
        },
        "createFile":{
            text: 'Create File',
            href: '#'
        },
        "paste":{
            text: 'Paste',
            href: '#',
            action:function (e) {
                e.preventDefault();
                console.log('action paste');
            }
        },
        "deleter":{
            text: 'Delete',
            href: '#',
            action:function (e) {
                e.preventDefault();
                console.log(e);
                // console.log(context.target);
                // console.log(context.target.src);
//                deletePost($(context.target));
            },
            decorator:function ($li) {
                console.log($li);
                // $li.find("a").css({"color":"red"});
                return $li;
            }
        },
    };
    var _commonDirMenuMap = [contextMenuConfig.privilage,contextMenuConfig.rename,contextMenuConfig.download,contextMenuConfig.cut,contextMenuConfig.copy,contextMenuConfig.deleter];
    var _commonFileMenuMap = _commonDirMenuMap.slice(1);//不能设置可见度
    var _containerMenuMap = [contextMenuConfig.paste,contextMenuConfig.createFolder,contextMenuConfig.createFile];
    var _meta = {
        contentId: "fileContent",
        currentPathArr: [],
        modeView: 2,//1:列表 2:平铺
        tabView: 1,//1:All 2:picture 3:video 4:files
        tabType: {
            "1": ["*"],
            "2": ["pic"],
            "3": ["video"],
            "4": ["word", "excel", "pdf", "zip"]
        },
        suffixToClass: {
//            should init
        },
        suffixToType: {
            "doc": "word",
            "docx": "word",
            "xls": "excel",
            "xlsx": "excel",
            "pdf": "pdf",
            "ppt": "ppt",
            "zip": "zip",
            "rar": "zip",
            "mp4": "video",
            "jpeg": "pic",
            "jpg": "pic",
            "png": "pic",
            "gif": "pic",
        },
        typeToClass: {
            "word": "file-word",
            "excel": "file-excel",
            "pdf": "file-pdf",
            "ppt": "file-ppt",
            "zip": "file-zip",
            "video": "video",
            "pic": "pic"
        },

        //控制菜单选项
        contextMenuMap: {
            "mark-file-word":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-file-excel":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-file-pdf":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-file-ppt":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-file-zip":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-video":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-pic":{
                "map":_commonFileMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-file mark-common":{
                "map":_commonDirMenuMap,
                "decorator":function ($container,iter) {
                    return true;
                }
            },
            "mark-file mark-prev":{
                "map":[],
                "decorator":function ($container,iter) {
                    return false;
                }
            },
            "_container":{
                "map":_containerMenuMap,
                "decorator":function ($container,iter) {

                    iter(function ($li, data) {
                        // console.log(arguments);
                        var k = contextMenuConfig.getKeyByText(data.text);
                        if(k=='paste'){
                            $li.find("a").attr("disabled","true");
                            $li.find("a").css({"color":"gray"});
                        }
                    });

                    return true;
                }
            }
        }
    };

    function splitBySpace(cls) {
        return cls.split(/\s+/);
    }

    function getContentContainer() {
        return "#" + _meta.contentId;
    }
    $(function(){

//        $(".nano").nanoScroller({alwaysVisible: true});

        //图标点击事件
        $(getContentContainer()).on("click", ".icotop-span", function (e) {
//            console.log($(this));
//         console.log(e);
            e.stopPropagation();

            //关闭所有右键菜单
            //因为阻止冒泡 必须手动关闭菜单
            context.closeAll();

        });

//    var clses =  splitBySpace(cls);

//    for(var i=0;i<clses.length;i++) {
//        $base.find(".databasecontetdiv").addClass("mark-"+clses[i]);
//    }

        $(".databasecontetdiv > div.icotop-span > span:not(.deleteico)  ").each(function (i,e) {
            console.log($(this));
            var parents = $(e).parents(".databasecontetdiv");
            var clses =  splitBySpace($(this).attr("class"));
            for(var i=0;i<clses.length;i++) {
                parents.addClass("mark-"+clses[i])
            }

        });

        context.init({
            preventDoubleContext: true,
            above:'auto',
            filter:function () {
                // console.log(arguments);
            }
        });

        // context.settings({compress: true});
        for(var n in _meta.contextMenuMap) {
            var markClasses=splitBySpace(n);
            var items = _meta.contextMenuMap[n]["map"];
            var markClassesStr="."+markClasses.join(".");
            console.log(markClassesStr);

            // if(items.length==0){
            //     $(document).on('contextmenu', markClassesStr, closeAllContextMenu);
            // }else {
            context.attach(markClassesStr, items,_meta.contextMenuMap[n]["decorator"]);
            // }

        }

        //container contextmenu
        context.attach( '.databasecontet-r', _meta.contextMenuMap["_container"]["map"],_meta.contextMenuMap["_container"]["decorator"]);
        // $(document).on('contextmenu', '#fileContent', closeAllContextMenu);


        console.log('sdds');

        $.ajax({
            url:"sdfs.go",
            type:"post"
        });


    });

</script>
</body>
</html>
